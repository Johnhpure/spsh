import{C as e,E as t,O as n,S as r,a as i,b as a,d as o,f as s,g as c,h as l,l as u,m as d,o as f,p,s as m,t as h,u as g,v as _,w as v,x as y,y as b}from"./index--W4qwciW.js";import{n as x,t as S}from"./ErrorState-BNKmJgS4.js";var C={class:`filter-panel`},w={class:`filter-form`},T={class:`filter-item`},E={class:`filter-item`},D={class:`filter-item`},O={class:`filter-item`},k=f(l({__name:`FilterPanel`,props:{initialFilters:{default:()=>({})}},emits:[`apply`,`reset`],setup(e,{emit:t}){let n=e,i=t,a=v({productId:n.initialFilters?.productId||``,stage:n.initialFilters?.stage||void 0,keyword:n.initialFilters?.keyword||``}),o=v(n.initialFilters?.startDate&&n.initialFilters?.endDate?[n.initialFilters.startDate,n.initialFilters.endDate]:null);y(o,e=>{e&&e.length===2?(a.value.startDate=e[0],a.value.endDate=e[1]):(delete a.value.startDate,delete a.value.endDate)});let c=()=>{let e={};a.value.productId?.trim()&&(e.productId=a.value.productId.trim()),a.value.stage&&(e.stage=a.value.stage),a.value.keyword?.trim()&&(e.keyword=a.value.keyword.trim()),a.value.startDate&&(e.startDate=a.value.startDate),a.value.endDate&&(e.endDate=a.value.endDate),i(`apply`,e)},l=()=>{a.value={productId:``,stage:void 0,keyword:``},o.value=null,i(`reset`)};return(e,t)=>{let n=b(`el-input`),i=b(`el-col`),f=b(`el-option`),m=b(`el-select`),h=b(`el-date-picker`),g=b(`el-row`),v=b(`el-button`),y=b(`el-card`);return _(),s(`div`,C,[d(y,{shadow:`never`},{default:r(()=>[u(`div`,w,[d(g,{gutter:20},{default:r(()=>[d(i,{xs:24,sm:12,md:6},{default:r(()=>[u(`div`,T,[t[4]||=u(`label`,{class:`filter-label`},`商品ID`,-1),d(n,{modelValue:a.value.productId,"onUpdate:modelValue":t[0]||=e=>a.value.productId=e,placeholder:`请输入商品ID`,clearable:``},null,8,[`modelValue`])])]),_:1}),d(i,{xs:24,sm:12,md:6},{default:r(()=>[u(`div`,E,[t[5]||=u(`label`,{class:`filter-label`},`审核阶段`,-1),d(m,{modelValue:a.value.stage,"onUpdate:modelValue":t[1]||=e=>a.value.stage=e,placeholder:`请选择审核阶段`,clearable:``,style:{width:`100%`}},{default:r(()=>[d(f,{label:`文本审核`,value:`text`}),d(f,{label:`图片审核`,value:`image`}),d(f,{label:`经营范围审核`,value:`business_scope`})]),_:1},8,[`modelValue`])])]),_:1}),d(i,{xs:24,sm:12,md:6},{default:r(()=>[u(`div`,D,[t[6]||=u(`label`,{class:`filter-label`},`时间范围`,-1),d(h,{modelValue:o.value,"onUpdate:modelValue":t[2]||=e=>o.value=e,type:`daterange`,"range-separator":`至`,"start-placeholder":`开始日期`,"end-placeholder":`结束日期`,"value-format":`YYYY-MM-DD`,style:{width:`100%`}},null,8,[`modelValue`])])]),_:1}),d(i,{xs:24,sm:12,md:6},{default:r(()=>[u(`div`,O,[t[7]||=u(`label`,{class:`filter-label`},`关键词搜索`,-1),d(n,{modelValue:a.value.keyword,"onUpdate:modelValue":t[3]||=e=>a.value.keyword=e,placeholder:`搜索失败原因`,clearable:``},null,8,[`modelValue`])])]),_:1})]),_:1}),d(g,{class:`button-row`},{default:r(()=>[d(i,null,{default:r(()=>[d(v,{type:`primary`,onClick:c},{default:r(()=>[...t[8]||=[p(` 应用筛选 `,-1)]]),_:1}),d(v,{onClick:l},{default:r(()=>[...t[9]||=[p(` 重置 `,-1)]]),_:1})]),_:1})]),_:1})])]),_:1})])}}}),[[`__scopeId`,`data-v-c75ed071`]]),A={class:`record-list-container`},j={class:`action-bar`},M=f(l({__name:`RecordList`,setup(n){let l=i(),f=v(!1),y=v(!1),C=v(!1),w=v([]),T=v(1),E=v(20),D=v({page:1,limit:20,total:0,totalPages:0}),O=v({}),M=async()=>{f.value=!0,C.value=!1;try{let e=await x.getRecords(O.value,{page:T.value,limit:E.value});w.value=e.records,D.value=e.pagination}catch{C.value=!0,w.value=[]}finally{f.value=!1}},N=e=>{O.value=e,T.value=1,M()},P=()=>{O.value={},T.value=1,M()},F=e=>{T.value=e,M()},I=e=>{E.value=e,T.value=1,M()},L=e=>{l.push(`/records/${e.id}`)},R=e=>({text:`primary`,image:`success`,business_scope:`warning`})[e]||`info`,z=e=>({text:`文本审核`,image:`图片审核`,business_scope:`经营范围审核`})[e]||e,B=e=>new Date(e).toLocaleString(`zh-CN`,{year:`numeric`,month:`2-digit`,day:`2-digit`,hour:`2-digit`,minute:`2-digit`,second:`2-digit`}),V=async()=>{y.value=!0;try{let e=await x.exportRecords(O.value),t=URL.createObjectURL(e),n=document.createElement(`a`);n.href=t,n.download=`audit-records-${new Date().toISOString().split(`T`)[0]}.csv`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),h.success(`导出成功`)}catch{}finally{y.value=!1}};return c(()=>{M()}),(n,i)=>{let c=b(`el-button`),l=b(`el-progress`),h=b(`el-table-column`),v=b(`el-image`),x=b(`el-tag`),H=b(`el-table`),U=b(`el-empty`),W=b(`el-pagination`),G=a(`loading`);return _(),s(`div`,A,[i[3]||=u(`h1`,{class:`page-title`},`审核记录列表`,-1),d(k,{"initial-filters":O.value,onApply:N,onReset:P},null,8,[`initial-filters`]),u(`div`,j,[d(c,{type:`primary`,loading:y.value,disabled:f.value||C.value,onClick:V},{default:r(()=>[...i[2]||=[p(` 导出CSV `,-1)]]),_:1},8,[`loading`,`disabled`])]),y.value?(_(),g(l,{key:0,percentage:100,indeterminate:!0,class:`export-progress`})):o(``,!0),C.value&&!f.value?(_(),g(S,{key:1,title:`加载失败`,"sub-title":`审核记录加载失败，请点击重试按钮重新加载`,onRetry:M})):o(``,!0),C.value?o(``,!0):(_(),s(m,{key:2},[e((_(),g(H,{data:w.value,style:{width:`100%`},onRowClick:L,class:`record-table`},{default:r(()=>[d(h,{prop:`productId`,label:`商品ID`,width:`150`}),d(h,{prop:`productTitle`,label:`标题`,"min-width":`200`}),d(h,{label:`主图`,width:`100`},{default:r(({row:e})=>[e.productImage?(_(),g(v,{key:0,src:e.productImage,"preview-src-list":[e.productImage],fit:`cover`,class:`product-thumbnail`},null,8,[`src`,`preview-src-list`])):o(``,!0)]),_:1}),d(h,{prop:`rejectionReason`,label:`失败原因`,"min-width":`200`}),d(h,{label:`审核阶段`,width:`150`},{default:r(({row:e})=>[d(x,{type:R(e.auditStage)},{default:r(()=>[p(t(z(e.auditStage)),1)]),_:2},1032,[`type`])]),_:1}),d(h,{label:`提交时间`,width:`180`},{default:r(({row:e})=>[p(t(B(e.submitTime)),1)]),_:1})]),_:1},8,[`data`])),[[G,f.value]]),!f.value&&w.value.length===0?(_(),g(U,{key:0,description:`暂无数据`})):o(``,!0),D.value.total>0?(_(),g(W,{key:1,"current-page":T.value,"onUpdate:currentPage":i[0]||=e=>T.value=e,"page-size":E.value,"onUpdate:pageSize":i[1]||=e=>E.value=e,total:D.value.total,"page-sizes":[10,20,50,100],layout:`total, sizes, prev, pager, next, jumper`,onCurrentChange:F,onSizeChange:I,class:`pagination`},null,8,[`current-page`,`page-size`,`total`])):o(``,!0)],64))])}}}),[[`__scopeId`,`data-v-6da65699`]]);export{M as default};